<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="../styles/settingsStyle.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500&display=swap" rel="stylesheet">
</head>

<body>
    <div class="parent">
        <div id="settingsTile">
            <div id="upTile">
                <a class="text_header">Дневник самонаблюдения</a>
                <button id="btnBack" onclick="window.location.href='main.html'">
                </button>
            </div>

            <div id="middleTile">
                <a id="countOfMistakes" class="rules">Оцените по шкале от 0 до 10 ваше</a>
                <br>
                <a id="demo1" class="rules">- общее самочувствие (0)</a>
                <div class="slidecontainer">
                    <div class="before_range">ужасно себя чувствую</div>
                    <input type="range" min="0" max="10" value="5" class="slider" id="myRange1">
                    <div class="after_range">чувствую себя исключительно бодро</div>
                </div>
                <br>
                <a id="demo2" class="rules">- настроение (0)</a>
                <div class="slidecontainer">
                    <div class="before_range">очень плохое настроение</div>
                    <input type="range" min="0" max="10" value="5" class="slider" id="myRange2">
                    <div class="after_range">отличное настроение</div>
                </div>
                <br>
                <a id="demo3" class="rules">- работоспособность (0)</a>
                <div class="slidecontainer">
                    <div class="before_range">совершенно не могу работать</div>
                    <input type="range" min="0" max="10" value="5" class="slider" id="myRange3">
                    <div class="after_range" id="workness">отличная работоспособность</div>
                </div>
                <br>
                <a id="demo4" class="rules">- сон (0)</a>
                <div class="slidecontainer">
                    <div class="before_range">очень плохо спал, бессоница</div>
                    <input type="range" min="0" max="10" value="5" class="slider" id="myRange4">
                    <div class="after_range">отличный сон, выспался</div>
                </div>
                <br>
                <a id="demo5" class="rules">- физическая активность (0)</a>
                <div class="slidecontainer">
                    <div class="before_range">не было физической активности</div>
                    <input type="range" min="0" max="10" value="5" class="slider" id="myRange5">
                    <div class="after_range">много физической активности, занятия физкультурой</div>
                </div>
                <br>
                <a id="demo6" class="rules">- вредные привычки (алкоголь, сигареты, игры) (0)</a>
                <div class="slidecontainer">
                    <div class="before_range">полностью воздерживался</div>
                    <input type="range" min="0" max="10" value="5" class="slider" id="myRange6">
                    <div class="after_range">много употреблял/играл</div>
                </div>
                <br>
                <a id="demo7" class="rules">- отдых (0)</a>
                <div class="slidecontainer">
                    <div class="before_range">не делал перерывов совсем</div>
                    <input type="range" min="0" max="10" value="5" class="slider" id="myRange7">
                    <div class="after_range">уделял время качественному отдыху</div>
                </div>
                <br>

                <a class="rules">ID респондента</a>
                <input id="search" type="text" placeholder="Write something..">
                <script>
                    localStorage.setItem('respondent_id', "")
                    search.value = localStorage.getItem('respondent_id');
                    search.oninput = () => {
                        localStorage.setItem('respondent_id', search.value)
                        console.log(localStorage.getItem('respondent_id'));
                    };
                </script>

                <script>
                    var slider1 = document.getElementById("myRange1");
                    var output1 = document.getElementById("demo1");
                    output1.innerHTML = '- общее самочувствие (' + slider1.value + ')';
                    localStorage.setItem('health_state', 5)
                    localStorage.setItem('mood', 5)
                    localStorage.setItem('efficiency', 5)
                    localStorage.setItem('dream', 5)
                    localStorage.setItem('physical_activity', 5)
                    localStorage.setItem('bad_habits', 5)
                    localStorage.setItem('rest', 5)
                    slider1.oninput = function () {
                        output1.innerHTML = '- общее самочувствие (' + this.value + ')';
                        localStorage.setItem('health_state', this.value)
                    }

                    var slider2 = document.getElementById("myRange2");
                    var output2 = document.getElementById("demo2");
                    output2.innerHTML = '- настроение (' + slider2.value + ')';
                    slider2.oninput = function () {
                        output2.innerHTML = '- настроение (' + this.value + ')';
                        localStorage.setItem('mood', this.value)
                    }

                    var slider3 = document.getElementById("myRange3");
                    var output3 = document.getElementById("demo3");
                    output3.innerHTML = '- работоспособность (' + slider3.value + ')';
                    slider3.oninput = function () {
                        output3.innerHTML = '- работоспособность (' + this.value + ')';
                        localStorage.setItem('efficiency', this.value)
                    }

                    var slider4 = document.getElementById("myRange4");
                    var output4 = document.getElementById("demo4");
                    output4.innerHTML = '- сон (' + slider4.value + ')';
                    slider4.oninput = function () {
                        output4.innerHTML = '- сон (' + this.value + ')';
                        localStorage.setItem('dream', this.value)
                    }

                    var slider5 = document.getElementById("myRange5");
                    var output5 = document.getElementById("demo5");
                    output5.innerHTML = '- физическая активность (' + slider5.value + ')';
                    slider5.oninput = function () {
                        output5.innerHTML = '- физическая активность (' + this.value + ')';
                        localStorage.setItem('physical_activity', this.value)
                    }

                    var slider6 = document.getElementById("myRange6");
                    var output6 = document.getElementById("demo6");
                    output6.innerHTML = '- вредные привычки (алкоголь, сигареты, игры) (' + slider6.value + ')';
                    slider6.oninput = function () {
                        output6.innerHTML = '- вредные привычки (алкоголь, сигареты, игры) (' + this.value + ')';
                        localStorage.setItem('bad_habits', this.value)
                    }

                    var slider7 = document.getElementById("myRange7");
                    var output7 = document.getElementById("demo7");
                    output7.innerHTML = '- отдых (' + slider7.value + ')';
                    slider7.oninput = function () {
                        output7.innerHTML = '- отдых (' + this.value + ')';
                        localStorage.setItem('rest', this.value)
                    }
                </script>
            </div>
            <div id="downTile">
                <button class="btn_default" onclick=writeIntoFile()>
                    Отправить
                </button>
            </div>

            <script>
                // Special for you (SENDING POST) ^^
                // function sendRequest(info) {
                //     var http = new XMLHttpRequest();
                //     var url = 'http://localhost:8080/coaches/add'; //// change url
                //     http.open('POST', url, true);

                //     //Send the proper header information along with the request
                //     http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

                //     console.log(http.responseText)

                //     http.onreadystatechange = function () {
                //         if (http.readyState == 4 && http.status == 200) {
                //             alert(http.responseText);

                //         }
                //     }
                //     http.send(info);
                //     console.log("Success")
                // }

                function download(content, fileName, contentType) {
                    var a = document.createElement("a");
                    console.log(content)
                    var file = new Blob([content], { type: contentType });

                    // sendRequest(content)

                    a.href = URL.createObjectURL(file);
                    a.download = fileName;
                    a.click();
                }

                function writeIntoFile() {
                    var fileName = (new Date().toLocaleString()).toString()
                    fileName += '.json'
                    download(getLocalStorage(), fileName, 'application/json');
                }

                function getLocalStorage() {
                    var b = {};
                    b['respondent_id'] = {};
                    b['health_state'] = {};
                    b['mood'] = {};
                    b['efficiency'] = {};
                    b['dream'] = {};
                    b['physical_activity'] = {};
                    b['bad_habits'] = {};
                    b['rest'] = {};

                    for (var i = 0; i < localStorage.length; i++) {
                        var k = localStorage.key(i);
                        var v = localStorage.getItem(k);
                        if (localStorage.key(i) == 'respondent_id') {
                            b['respondent_id'] = v;
                        } else if (localStorage.key(i) == 'health_state') {
                            b['health_state'] = v;
                        } else if (localStorage.key(i) == 'mood') {
                            b['mood'] = v;
                        } else if (localStorage.key(i) == 'efficiency') {
                            b['efficiency'] = v;
                        } else if (localStorage.key(i) == 'dream') {
                            b['dream'] = v;
                        } else if (localStorage.key(i) == 'physical_activity') {
                            b['physical_activity'] = v;
                        } else if (localStorage.key(i) == 'bad_habits') {
                            b['bad_habits'] = v;
                        } else if (localStorage.key(i) == 'rest') {
                            b['rest'] = v;
                        }
                    }
                    a = b['respondent_id']
                    c = b['health_state']
                    d = b['mood']
                    e = b['efficiency']
                    f = b['dream']
                    g = b['physical_activity']
                    h = b['bad_habits']
                    i = b['rest']

                    var str = "{\"respondent_id\": \"" + a + "\""
                    str += ", \"health_state\": " + c
                    str += ", \"mood\": " + d
                    str += ", \"efficiency\": " + e
                    str += ", \"dream\": " + f
                    str += ", \"physical_activity\": " + g
                    str += ", \"bad_habits\": " + h
                    str += ", \"rest\": " + i
                    str += "}"
                    console.log(str)
                    return str;
                }
            </script>
        </div>
    </div>
</body>

</html>